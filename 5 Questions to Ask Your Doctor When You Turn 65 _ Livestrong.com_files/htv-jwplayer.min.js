"use strict";var indexRootNamespaceRename=indexRootNamespaceRename||"indexapi";"string"!=typeof indexRootNamespaceRename&&(indexRootNamespaceRename="indexapi"),function(){window[indexRootNamespaceRename]=window[indexRootNamespaceRename]||{},"function"!=typeof Object.assign&&(Object.assign=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i[r]=o[r])}return i});var e=function(){function e(e,t,i,n,o,r){var a={};return{getBidUrlTargets:function(e){var t=/^https?:\/\/.*\/pcreative\?(.*)/i.exec(r);if(null===t)return D.debug("ERROR: Can not generate target params for non-video bid"),"";if(a[e]&&a[e].length>0)return a[e].join("&");for(var i=[],n=t[1].split("&"),o=0;o<n.length;o++){var s=n[o].split("=");d(s[0])||i.push(e+"_"+s[0]+"="+s[1])}return a[e]=i,i.join("&")},getTargetValue:function(t,r){if(void 0!==e){var a=i;if(t+="_pl","number"==typeof r)if(1===r)a=void 0===n?void 0:n.toString();else if(2===r){var s=t.split("_"),d={pr:"a",m:"b",po:"c"}[s[0]],u=+s[1],c=+s[2];if(void 0===d||isNaN(u)||isNaN(c))return void D.debug("ERROR: invalid prefix.");if(u>26||c>26)return void D.debug("ERROR: Cannot support targeting for pods/ppos over 26.");if(t=d+String.fromCharCode(96+u)+String.fromCharCode(96+c),void 0!==s[3]&&!isNaN(s[3])){var f=Math.min(Math.floor(+s[3]/5),25);t+=String.fromCharCode(97+f)}}var l=void 0!==a?a:o;return void 0===l?void D.debug("ERROR: Cannot get target value if both dealID and price level are undefined"):0===l.indexOf("_")?t+l:t+"_"+l}return void D.debug("ERROR: No video impressions were found")},getBrandID:function(){return t},getDealID:function(){return i},getInternalDealID:function(){return n},getPriceLevel:function(){return o},getVASTCreativeURL:function(){return r},getVideoImpression:function(){return e}}}function t(e,t,i,n){var o=!1;return"string"!=typeof e&&(D.debug("ERROR: Slot ID is not a string."),o=!0),void 0!==i&&("number"!=typeof i||i<0)&&(D.debug("ERROR: Bid Floor is not a valid number."),o=!0),void 0===n||"string"==typeof n&&3===n.length||(D.debug("ERROR: Bid Floor Currency is not a valid ISO currency string."),o=!0),void 0!==t&&("number"!=typeof t||t%1!=0||t<0)&&(D.debug("ERROR: Site ID is not a valid number."),o=!0),!o}function i(e,t,i,n,o,r,a,s){var d,u=!1;if(e instanceof Array)for(e.length<1&&(D.debug("ERROR: Mimes is empty."),u=!0),d=0;d<e.length;d++)("string"!=typeof e[d]||e[d].length<1)&&(D.debug("ERROR: Mimes index "+d+" is not a valid string."),u=!0);else D.debug("ERROR: Mimes is not an array."),u=!0;if(("number"!=typeof t||t%1!=0||t<0)&&(D.debug("ERROR: Minimum Duration is not a valid number."),u=!0),("number"!=typeof i||i%1!=0||i<0)&&(D.debug("ERROR: Maximum Duration is not a valid number."),u=!0),t>i&&(D.debug("ERROR: Minimum Duration cannot exceed Maximum Duration."),u=!0),void 0!==n&&("number"!=typeof n||n%1!=0||n<0)&&(D.debug("ERROR: Minimum Play Time is not a valid number."),u=!0),o instanceof Array)for(o.length<1&&(D.debug("ERROR: Protocols is empty."),u=!0),d=0;d<o.length;d++)("number"!=typeof o[d]||o[d]%1!=0||o[d]<1)&&(D.debug("ERROR: Protocols index "+d+" is not a valid number."),u=!0);else D.debug("ERROR: Protocols is not an array."),u=!0;return void 0!==r&&("number"!=typeof r||r%1!=0||r<1)&&(D.debug("ERROR: Width is not a valid number."),u=!0),void 0!==a&&("number"!=typeof a||a%1!=0||a<1)&&(D.debug("ERROR: Height is not a valid number."),u=!0),void 0!==s&&("number"!=typeof s||s%1!=0||s<1)&&(D.debug("ERROR: Linearity is not a valid number."),u=!0),!u}function n(e){var t=S[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}function o(e){return T.lastIndex=0,T.test(e)?e.replace(T,n):e}function r(e,t,i){if(Array.prototype.map)return e.map(t);if("function"!=typeof t)throw new TypeError(t+" is not a function");for(var n=i,o=new Array(e.length),r=0;r<e.length;r++)r in e&&(o[r]=t.call(n,e[r],r,e));return o}function a(e,t){return{getObject:function(){return{w:e,h:t}}}}function s(e,t,i,n){var o=[],r=function(t,i){if(0!==e.getResponse().getStatus())return{};var o=[],r=[],s=[];if(!0===e.getBrandExclusion()){for(var d={},u=0;u<n.length;u++){var c=(m=n[u]).getBrandID(),f={pr:"a",m:"b",po:"c"},l=m.getVideoImpression().getSlotID().split("_"),p=f[l[0]]+String.fromCharCode(+l[1]+96)+String.fromCharCode(+l[2]+96),g=l[3];(void 0===d[c]||g>d[c].duration||g===d[c].duration&&p<d[c].position)&&(d[c]={bid:m,position:p,duration:g})}for(var c in d)s.push(d[c].bid)}else s=n;for(u=0;u<s.length;u++){var m=s[u];if(m.getVASTCreativeURL()){var R=m.getTargetValue(m.getVideoImpression().getSlotID(),i);if(void 0===R)continue;if(o.push(m.getBidUrlTargets(m.getVideoImpression().getSlotID())),r.push(R),(encodeURIComponent(t)+encodeURIComponent(o.join("&")+"&IVT="+r.join(","))).length>b){o.pop(),r.pop();break}}}o.push(a());var v="IVT="+r.join(",");o.push(v);var h={};for(var y in o)for(var I=o[y].split("&"),u=0;u<I.length;u++){var E=I[u].split("=");h[E[0]]=E[1]}return h},a=function(){var e=/^https?:\/\/.*\/pcreative\?(.*)/i;if(!(n.length>0))return"";var t=e.exec(n[0].getVASTCreativeURL());if(null===t)return D.debug("ERROR: Can not generate target params for non-video bid"),"";if(o.length>0)return o.join("&");for(var i=t[1].split("&"),r=0;r<i.length;r++){var a=i[r].split("=");d(a[0])&&o.push("pc_"+a[0]+"="+a[1])}return o.join("&")};return{getRequest:function(){return e},getResponseXML:function(){return i},getStatus:function(){return t},getCustParamsObj:r}}function d(e){return"au"===e||"n"===e||"epr"===e||"u"===e||"pr"===e||"unk1"===e}function u(e,n){var o={};o.id=e.toString(),o.siteID=n,o.requestSent=!1,o.topframe=void 0,o.hostname="https:"===window.location.protocol?"https://instream.casalemedia.com":"http://instream.casalemedia.com",E[o.id]={},o.timeout=void 0,o.currentImpressionID=0,o.impressions=[],o.brandExclusion=!1,o.pageUrl=void 0,top===self?(o.pageUrl=location.href,o.topframe=1):(o.pageUrl=document.referrer,o.topframe=0);var r=function(){return o.brandExclusion},a=function(e){return"boolean"!=typeof e?(D.debug("ERROR: Brand Exclusion for Request "+o.id+" is not a boolean."),!1):(o.brandExclusion=e,!0)},d=function(){var e={};e.id=o.id,e.imp=[],e.site={page:o.pageUrl},"string"==typeof document.referrer&&(e.site.ref=document.referrer);for(var t=0;t<o.impressions.length;t++){var i=o.impressions[t].getObject();void 0!==i&&e.imp.push(i)}return e};"true"===j("indexapi_sandbox",x)&&(o.hostname="https:"===window.location.protocol?"https://sandbox.ht.indexexchange.com":"http://sandbox.ht.indexexchange.com");var u=function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.onload=function(){try{-1!==t.responseText.indexOf("cust_params")?(I[o.id]=s(y[o.id],0,t.responseXML),D.debug("DEBUG: Successful Playlist response parsed."),"function"==typeof E[o.id].success?E[o.id].success(I[o.id]):"function"==typeof E[o.id].request?E[o.id].request(I[o.id]):"function"==typeof l&&l(I[o.id])):(I[o.id]=s(y[o.id],1),D.debug("DEBUG: Pass Playlist response parsed."),"function"==typeof E[o.id].pass?E[o.id].pass(o.requests[o.id]):"function"==typeof E[o.id].request?E[o.id].request(I[o.id]):"function"==typeof l&&l(I[o.id]))}catch(e){D.debug("ERROR: Error in calling success callback: "+e.toString())}};var i=o.timeout||h;return t.withCredentials=!0,t.timeout=i,t.ontimeout=function(){try{I[o.id]=s(y[o.id],3),w[o.id]=!0,D.debug("DEBUG: Request "+o.id+" timed out"),"function"==typeof E[o.id].timeout?E[o.id].timeout(y[o.id]):"function"==typeof E[o.id].request?E[o.id].request(I[o.id]):"function"==typeof l&&l(I[o.id])}catch(e){D.debug("ERROR: Error in calling timeout callback: "+e.toString())}},t.onerror=t.onabort=function(){D.debug("ERROR: Sending IVA Request Failed");try{I[o.id]=s(y[o.id],2),"function"==typeof E[o.id].error?E[o.id].error(y[o.id]):"function"==typeof E[o.id].request?E[o.id].request(I[o.id]):"function"==typeof l&&l(I[o.id])}catch(e){D.debug("ERROR: Error in calling error handling callback: "+e.toString())}},t.send(),o.requestSent=!0,D.debug("DEBUG: Request "+o.id+" successfully sent to "+o.hostname+"."),!0},f=function(e){return o.requestSent?(D.debug("ERROR: Request "+o.id+" has already been sent, will not send request."),!1):"function"!=typeof l&&"function"!=typeof E[o.id].request&&"function"!=typeof E[o.id].success?(D.debug("ERROR: Request "+o.id+" is missing a callback, will not send request."),!1):u(e)};return{getHostname:function(){return o.hostname},getID:function(){return o.id},getResponse:function(){return I[o.id]},sendRequest:function(e){return"string"!=typeof e?(D.debug("ERROR: IVA Request Url is not a valid string."),!1):(D.debug("DEBUG: Sending request "+o.id),f(e))},sendImpressions:function(){if(o.impressions.length<1)return D.debug("ERROR: Request "+o.id+" contains no impressions, will not send request."),!1;var e=o.timeout||h;e>0&&(O[o.id]=window.setTimeout(function(){try{I[o.id]=s(y[o.id],3),w[o.id]=!0,D.debug("DEBUG: Request "+o.id+" timed out"),"function"==typeof E[o.id].timeout?E[o.id].timeout(y[o.id]):"function"==typeof E[o.id].request?E[o.id].request(I[o.id]):"function"==typeof l&&l(I[o.id])}catch(e){D.debug("ERROR: Error in calling timeout callback: "+e.toString())}},e));var t=d();if(o.hostname.match(/^https?:\/\//i))i=o.hostname;else var i=location.protocol+"//"+o.hostname;var n="&fn="+encodeURIComponent(indexRootNamespaceRename+".jsonpResponse");for(i+="/cygnus?v="+R+"&s="+o.siteID+n,/^https?:\/\/as(?:-sec)?\.casalemedia\.com/i.test(i)||(i+="&C=1"),void 0!==m&&(i+="&nf="+m);(i+"&r="+encodeURIComponent(A(t))).length>v;)t.imp.pop();i+="&r="+encodeURIComponent(A(t));var r=document.createElement("script");r.setAttribute("async",!0),r.setAttribute("src",i),r.setAttribute("type","text/javascript");var a=document.getElementsByTagName("script")[0];return a.parentNode&&a.parentNode.insertBefore(r,a),!0},setCallback:function(e){return"function"!=typeof e?(D.debug("ERROR: Generic callback for Request "+o.id+" is not a function."),!1):(E[o.id].request=e,!0)},setErrorCallback:function(e){return"function"!=typeof e?(D.debug("ERROR: Error callback for Request "+o.id+" is not a function."),!1):(E[o.id].error=e,!0)},setPassCallback:function(e){return"function"!=typeof e?(D.debug("ERROR: Pass callback for Request "+o.id+" is not a function."),!1):(E[o.id].pass=e,!0)},setTimeout:function(e){return"number"!=typeof e||e%1!=0||e<0?(D.debug("ERROR: Timeout for Request "+o.id+" is not a number."),!1):(o.timeout=e,!0)},setSuccessCallback:function(e){return"function"!=typeof e?(D.debug("ERROR: Success callback for Request "+o.id+" is not a function."),!1):(E[o.id].success=e,!0)},setTimeoutCallback:function(e){return"function"!=typeof e?(D.debug("ERROR: Timeout callback for Request "+o.id+" is not a function."),!1):(E[o.id].timeout=e,!0)},addMasterVideoTagImpression:function(e,n,r,a,s,d,u,f){var l=j("min_ad_duration",n);l=void 0===l?0:Math.floor(l/1e3),f=void 0===(f=f||j("max_ad_duration",n))?60:Math.floor(f/1e3);var p=r.protocols||a.protocols,g=a.bidFloorCurrency,m=r.mimes||a.mimes,R=r.siteID,v=r.bidFloor||a.bidFloor,b=r.skippable||a.skippable,h=r.minBitRate||a.minBitRate,y=r.maxBitRate||a.maxBitRate,I=r.apiList||a.apiList,E=r.playbackMethods||a.playbackMethods,w=r.deliveryMethods||a.deliveryMethods,O=j("vad_type",n);switch(O){case"linear":O=1;break;case"nonlinear":O=2;break;default:O=1}for(var x=m.length,k=!1,A=-1!==navigator.appVersion.indexOf("MSIE")||-1!==navigator.appVersion.indexOf("Trident");x--;)-1!==m[x].indexOf("webm")&&A?m.splice(x,1):-1===m[x].indexOf("application/javascript")||(k=!0);!k&&I instanceof Array&&I.length>1&&m.push("application/javascript");var T=!1;if(void 0===v&&(g=void 0),t(e,R,v,g)||(T=!0),i(m,l,f,void 0,p,s,d)||(T=!0),!T){var S=c(o.currentImpressionID,this,e,m,l,f,p,s,d,v,g,O,R,b,a.position,u,h,y,I,E,w);if(S.isValid())return o.currentImpressionID++,o.impressions.push(S),D.debug("DEBUG: Master Video Tag Impression successfully added."),S;D.debug("ERROR: Adding Master Video Tag Impression failed. Some parameters were invalid.")}},getImpressions:function(){return o.impressions},setBrandExclusion:a,getBrandExclusion:r}}function c(e,t,i,n,o,r,s,d,u,c,f,l,p,g,m,R,v,b,h,y,I){e=e.toString();var h,I,b,v,y,m,R,E={},w=[16],O=[],x=function(){return e},k=function(){return i},A=function(){for(var e in E)if(!E[e])return!1;return!0},T=function(){if(A()){var t={id:e,video:{mimes:n,minduration:o,maxduration:r,protocols:s},ext:{sid:i}};if(O.length>0){t.video.companionad=[];for(var a=0;a<O.length;a++)t.video.companionad.push(O[a].getObject())}return"number"==typeof g&&g>0&&(t.video.battr=w),"number"==typeof R&&(t.video.startdelay=R),"number"==typeof v&&(t.video.minbitrate=v),"number"==typeof b&&(t.video.maxbitrate=b),"object"==typeof y&&(t.video.playbackmethod=y),"object"==typeof I&&(t.video.delivery=I),"object"==typeof h&&(t.video.api=h),"number"==typeof m&&(t.video.pos=m),"number"==typeof d&&(t.video.w=d),"number"==typeof u&&(t.video.h=u),"number"==typeof l&&(t.video.linearity=l),"number"==typeof c&&(t.bidfloor=c),"string"==typeof f&&(t.bidfloorcur=f),"number"==typeof p&&(t.ext.siteID=p),t}},S=function(t,i){var n=!1;if(("number"!=typeof t||t%1!=0||t<1)&&(D.debug("ERROR: Width for Request "+e+" is not a valid number."),n=!0),("number"!=typeof i||i%1!=0||i<1)&&(D.debug("ERROR: Height for Request "+e+" is not a valid number."),n=!0),!n){var o=a(t,i);return O.push(o),D.debug("DEBUG: Companion banner successfully added."),o}},N=function(){return g};return function(){if(void 0!==m&&("number"!=typeof m||m%1!=0||m<1)&&(D.debug("ERROR: Position for Video Impression "+e+" is not a valid number."),D.debug("DEBUG: Impression "+e+" will not be added to the Request."),E.position=!1),void 0===R||"number"==typeof R&&R%1==0||(D.debug("ERROR: Start Delay for Video Impression "+e+" is not a valid number."),D.debug("DEBUG: Impression "+e+" will not be added to the Request."),E.startDelay=!1),void 0!==g&&("number"!=typeof g||g%1!=0||g<0)&&(D.debug("ERROR: Skip Time for Video Impression "+e+" is not a valid number."),D.debug("DEBUG: Impression "+e+" will not be added to the Request."),E.minPlayTime=!1),void 0!==v&&("number"!=typeof v||v%1!=0||v<0)&&(D.debug("ERROR: Min Bit Rate for Video Impression "+e+" is not a valid number."),D.debug("DEBUG: Impression "+e+" will not be added to the Request."),E.minBitrate=!1),void 0!==b&&("number"!=typeof b||b%1!=0||b<1)&&(D.debug("ERROR: Max Bit Rate for Video Impression "+e+" is not a valid number."),E.maxBitrate=!1),void 0!==h)if(h instanceof Array){h.length<1&&(D.debug("ERROR: API List for Video Impression "+e+" is empty."),E.apiList=!1);for(t=0;t<h.length;t++)("number"!=typeof h[t]||h[t]%1!=0||h[t]<1)&&(D.debug("ERROR: API list index "+t+" for Video Impression "+e+" is not a valid number."),E.apiList=!1)}else D.debug("ERROR: API list for Video Impression "+e+" is not an array."),E.apiList=!1;if(void 0!==y)if(y instanceof Array){y.length<1&&(D.debug("ERROR: Playback Methods for Video Impression "+e+" is empty."),E.playbackMethods=!1);for(t=0;t<y.length;t++)("number"!=typeof y[t]||y[t]%1!=0||y[t]<1)&&(D.debug("ERROR: Playback Method index "+t+" for Video Impression "+e+" is not a valid number."),E.playbackMethods=!1)}else D.debug("ERROR: Playback Methods for Video Impression "+e+" is not an array."),E.playbackMethods=!1;if(void 0!==I)if(I instanceof Array){I.length<1&&(D.debug("ERROR: Delivery Methods for Video Impression "+e+" is empty."),E.deliveryMethods=!1);for(var t=0;t<I.length;t++)("number"!=typeof I[t]||I[t]%1!=0||I[t]<1)&&(D.debug("ERROR: Delivery Method index "+t+" for Video Impression "+e+" is not a valid number."),E.deliveryMethods=!1)}else D.debug("ERROR: Delivery Methods for Video Impression "+e+" is not an array."),E.deliveryMethods=!1;A()||D.debug("DEBUG: Impression "+e+" will not be added to the Request.")}(),{addCompanion:S,getImpressionID:x,getSlotID:k,getMinPlayTime:N,getObject:T,isValid:A}}function f(e,t){if("string"!=typeof e||0===e.length)return D.debug("ERROR: Master video tag is not a valid string."),e;if("string"!=typeof t)return D.debug("ERROR: cust_params is not a valid string."),e;var i=/(^.+&cust_params=)(.+?)(&.+|$)/,n=e.match(i);if(n){var o="%26"===n[2].slice(-3)?"":"%26",r=n[2]+o+t;e=n[1]+r+n[3]}else e+="&cust_params="+t;return e}var l,p,g,m,R="10.0",v=8e3,b=7500,h=0,y={},I={},E={},w={},O={},x=top===self?location.href:document.referrer,D=function(){var e=0;return{enabled:function(t){e=t?1:0},debug:function(t){1==e&&console.log("[INDEX] "+t)}}}(),k={width:960,height:540};if(void 0!==document.documentMode&&document.documentMode<9)return D.enabled(!0),void D.debug("ERROR: Constellation v"+R+" does not support IE versions running below 9 standards mode.");var A=function(e){var t='{"id":"'+e.id+'","site":{"page":"'+o(e.site.page)+'"';"string"==typeof e.site.ref&&(t+=',"ref":"'+o(e.site.ref)+'"'),t+='},"imp":[';for(var i=0;i<e.imp.length;i++){var n=e.imp[i],a=[];if(t+='{"id":"'+n.id+'"',void 0!==n.video){var s=n.video,d=[];if(t+=',"video":{"mimes":["'+r(s.mimes,o).join('","')+'"]',t+=',"minduration":'+s.minduration+',"maxduration":'+s.maxduration,void 0!==s.companionad){t+=',"companionad":[';for(var u=[],c=0;c<s.companionad.length;c++){var f=s.companionad[c];u.push('{"w":'+f.w+',"h":'+f.h+"}")}t+=u.join(","),t+="]"}t+=',"protocols":['+s.protocols.join(",")+"]",void 0!==s.w&&(t+=',"w":'+s.w),void 0!==s.h&&(t+=',"h":'+s.h),void 0!==s.linearity&&(t+=',"linearity":'+s.linearity),void 0!==s.api&&(t+=',"api":['+s.api.join(",")+"]"),void 0!==s.delivery&&(t+=',"delivery":['+s.delivery.join(",")+"]"),void 0!==s.maxbitrate&&(t+=',"maxbitrate":'+s.maxbitrate),void 0!==s.minbitrate&&(t+=',"minbitrate":'+s.minbitrate),void 0!==s.playbackmethod&&(t+=',"playbackmethod":['+s.playbackmethod.join(",")+"]"),void 0!==s.pos&&(t+=',"pos":'+s.pos),void 0!==s.startdelay&&(t+=',"startdelay":'+s.startdelay),void 0!==s.battr&&(t+=',"battr":['+s.battr.join(",")+"]"),d.length>0&&(t+=',"ext":{'+d.join()+"}"),t+="}"}"number"==typeof n.bidfloor&&(t+=',"bidfloor":'+n.bidfloor,"string"==typeof n.bidfloorcur&&(t+=',"bidfloorcur":"'+o(n.bidfloorcur)+'"')),"string"!=typeof n.ext.sid||n.ext.sid.match(/^\s*$/)||a.push('"sid":"'+o(n.ext.sid)+'"'),"number"==typeof n.ext.siteID&&a.push('"siteID":'+n.ext.siteID),a.length>0&&(t+=',"ext":{'+a.join()+"}"),i+1==e.imp.length?t+="}":t+="},"}return t+="]",t+="}"},T=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,S={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},N=window[indexRootNamespaceRename].deferQueue||[],q=function(e){if(!("number"!=typeof e||e%1!=0||e<0)){p=void 0===p?Math.floor(256*Math.random()):(p+1)%256;var t=u(String((new Date).getTime()%2592e3*256+p+256),e);return y[t.getID()]=t,t}D.debug("ERROR: Invalid siteID when creating Request")},j=function(e,t){var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","g"),n=t.match(i);if(n){var o=[];for(var r in n)o.push(n[r].split("=")[1]);var a=o.join("&");return decodeURIComponent(a.replace(/\+/g," "))}},C=function(e){var t={},i=j("cust_params",e);return void 0!==i&&i.split("&").forEach(function(e){var i=e.split("=");""!==i[0]&&(t[i[0]]=i[1])}),t},V=function(e){if(void 0!==e&&"function"==typeof e.getElementsByTagNameNS){var t=e.getElementsByTagNameNS("*","VASTAdTagURI");if(0!==t.length)return t[0].textContent.trim()}},M=function(e,t){var i=t.split("?");if(i.length>=2){for(var n=encodeURIComponent(e),o=i[1].split(/[&;]/g),r=o.length;r-- >0;)-1!==o[r].lastIndexOf(n,0)&&(-1===o[r].lastIndexOf(n+"=",0)&&-1===t.lastIndexOf("&"+n+"&")&&-1===t.lastIndexOf("?"+n+"&")||o.splice(r,1));return t=i[0]+(o.length>0?"?"+o.join("&"):"")}return t},B=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i+"="+e[i]);return t.join("&")},P=function(e,t){try{"object"==typeof t&&"string"==typeof e&&JSON.stringify(t)!==JSON.stringify({})&&(e=f(e,encodeURIComponent(B(t))))}catch(e){}return e},U=function(){window[indexRootNamespaceRename].htvconfig=window[indexRootNamespaceRename].htvconfig||{};var e={videoCommonArgs:{protocols:[2,3,5,6],mimes:["video/mp4","video/webm","application/javascript","video/x-flv","application/x-shockwave-flash"],apiList:[1,2],timeout:1e3}};window[indexRootNamespaceRename].htvconfig.videoCommonArgs=Object.assign({},e.videoCommonArgs,window[indexRootNamespaceRename].htvconfig.videoCommonArgs),window[indexRootNamespaceRename].htvconfig.videoOverrides=Object.assign({},e.videoOverrides,window[indexRootNamespaceRename].htvconfig.videoOverrides),window[indexRootNamespaceRename].htvconfig=Object.assign({},e,window[indexRootNamespaceRename].htvconfig),window[indexRootNamespaceRename].htvconfig.siteID=_()||window[indexRootNamespaceRename].htvconfig.siteID},_=function(){var e;if(window[indexRootNamespaceRename].SITE_ID_MAPPING){var t,i=x;t=(t=(i=i.toLowerCase()).indexOf("://")>-1?i.split("/")[2]:i.split("/")[0]).split(":")[0];for(var n in window[indexRootNamespaceRename].SITE_ID_MAPPING)if(window[indexRootNamespaceRename].SITE_ID_MAPPING.hasOwnProperty(n)&&-1!==t.indexOf(n)){e=window[indexRootNamespaceRename].SITE_ID_MAPPING[n];break}return e}},G=function(e,t,i){try{if("function"!=typeof t)return D.debug("ERROR: Callback is not a function"),!1;if("string"!=typeof e)return t(),D.debug("ERROR: Master Video Tag is not a string."),!1;var n=window[indexRootNamespaceRename].htvconfig.siteID,o=window[indexRootNamespaceRename].htvconfig.videoCommonArgs,r=window[indexRootNamespaceRename].htvconfig.videoOverrides;if(void 0!==i){if("object"!=typeof i)return D.debug("ERROR: Configuration override is not an object."),t(e),!1;n=i.siteID,o=Object.assign({},o,i.videoCommonArgs),r=Object.assign({},r,i.videoOverrides)}if(o.masterVideoTag=e,"number"!=typeof n)return D.debug("ERROR: Site ID not found."),t(e),!1;var a=j("ad_rule",e);if(void 0!==a&&"1"===a){"number"==typeof o.notificationFormat&&1===o.notificationFormat&&(m=1);var s=new XMLHttpRequest;s.onload=function(){if(4==s.readyState&&200==s.status){var i=(new DOMParser).parseFromString(s.responseText,"text/xml"),a=z(n,i,o,r);if(D.debug("Successfully retrieved playlist."),void 0===a)return D.debug("ERROR: Error when creating playlist request."),void t(e);if(a.setCallback(function(i){var n=i.getCustParamsObj(e);t(P(e,n),n)}),o.companionAds instanceof Array)for(var d=0;d<o.companionAds.length;d++)a.getImpressions()[0].addCompanion(o.companionAds[d].width,o.companionAds[d].height);a.sendImpressions()||t(e)}},s.timeout=o.timeout,s.ontimeout=s.onerror=s.onabort=function(){t(e)},s.open("GET",e,!0),s.send()}else{var d=q(n);if(void 0===d)return t(e),!1;var u=M("cust_params",e),c=L(n,u,o,r,d);if(!c.match(/\/playlist\?/))return t(e),!1;if(d.setSuccessCallback(function(i){var n=V(i.getResponseXML()),o=C(n),r=P(e,o);t(r,o)}),d.setCallback(function(i){t(e)}),!d.sendRequest(c))return t(e),!1}return!0}catch(e){D.debug("ERROR: thrown in solicitIndexVideoAds: "+e)}return t(e),!1},L=function(e,t,i,n,o,r,a,s,d){var u,c=!1;void 0===o&&(c=!0);var f;f=(u=c?"https:"===window.location.protocol?"https://instream.casalemedia.com":"http://instream.casalemedia.com":o.getHostname()).match(/^https?:\/\//i)?u:location.protocol+"//"+u;var l={};if("string"!=typeof t)return D.debug("ERROR: Invalid videoTag when creating IVA Tag"),"";if(l.vt=encodeURIComponent(t),"number"!=typeof e||e%1!=0||e<0)return D.debug("ERROR: Invalid siteID when creating IVA Tag"),t;if(l.s=e,l.js=1,void 0===x||"string"!=typeof x?D.debug("ERROR: Invalid referrer when creating IVA Tag"):l.u=encodeURIComponent(x),i instanceof Array||"object"!=typeof i)return D.debug("ERROR: Invalid commonArgs when creating IVA Tag"),t;var m=!0;if(void 0!==(n=n||{})&&(n instanceof Array||"object"!=typeof n)&&(D.debug("ERROR: Invalid overrides when creating IVA Tag"),n={},m=!1),"1"===j("ad_rule",t))l.ca=encodeURIComponent(JSON.stringify(i)),m&&(l.so=encodeURIComponent(JSON.stringify(n))),g="playlist";else{l.v=R;var v;v=c?String((new Date).getTime()%2592e3*256+p+256):o.getID(),l.id=v;var b=i.protocols;if(!(b instanceof Array))return D.debug("ERROR: Invalid protocols when creating IVA Tag"),t;if(l.vastp=b.join("~"),"number"!=typeof(d=d||0))return D.debug("ERROR: Invalid startDelay when creating IVA Tag"),t;l.vasd=d;var h=j("vpos",t),y=j("mridx",t),I=j("ppos",t);void 0===h?"string"!=typeof r?(D.debug("ERROR: Invalid position when creating IVA Tag, defaulting to preroll"),r="preroll"):l.vpos=r:r=h,void 0===y?("preroll"!==r&&"postroll"!==r||("number"==typeof a&&1==a||D.debug("ERROR: Preroll and postroll pod value is invalid when creating IVA Tag, setting to 1"),a=1),"number"!=typeof a?(D.debug("ERROR: Invalid pod when creating IVA Tag, defaulting to 1"),a=1):l.pod=a):a=y,void 0===I?"number"!=typeof s?(D.debug("ERROR: Invalid ppos when creating IVA Tag, defaulting to 1"),s=1):l.ppos=s:s=I,n[r]=n[r]||{},n[r][a]=n[r][a]||{},n[r][a][s]=n[r][a][s]||{};var E=n[r][a][s].mimes||i.mimes;if(!(E instanceof Array))return D.debug("ERROR: Invalid mimes when creating IVA Tag"),t;l.vami=E.join("~");var w=n[r][a][s].apiList||i.apiList;if(void 0!==w)if(w instanceof Array){var O=w.join("~");l.api=O}else D.debug("ERROR: Invalid api when creating IVA Tag");var k=i.size;void 0!==k&&("string"!=typeof k?D.debug("ERROR: Invalid sizes when creating IVA Tag"):l.sz=k);var A=n[r][a][s].siteID;void 0!==A&&("number"!=typeof A?D.debug("ERROR: Invalid slot siteID when creating IVA Tag"):l.ss=A);var T=i.durations;if(void 0!==T)if(T instanceof Array){var S=T.join("~");l.dur=S}else D.debug("ERROR: Invalid duration list when creating IVA Tag");var N=i.timeout||1e3;("number"!=typeof N||N<0||N%1!=0)&&(D.debug("ERROR: Invalid timeout when creating IVA Tag, using default of 1 second"),N=1e3),l.to=N;var q=n[r][a][s].maxAdDuration||i.maxAdDuration;"number"!=typeof q||q<0||q%1!=0?D.debug("ERROR: Invalid max ad duration when creating IVA Tag"):l.maxd=q;var C=i.notificationFormat;"number"!=typeof C||C<0||C>1?D.debug("ERROR: Invalid notification format when creating IVA Tag"):l.nf=C,g="vast"}f+="/playlist?";for(var V in l)f+="ix_"+V+"="+l[V]+"&";return"&"===f.slice(-1)&&(f=f.slice(0,-1)),f},z=function(e,t,i,n){var o=q(e);if(void 0!==o)if("object"==typeof t)if("object"==typeof i){if(void 0!==i.brandExclusion&&o.setBrandExclusion(i.brandExclusion),"object"==typeof(n=n||{})){var r,a=t.childNodes[0].localName;switch(a){case"Playlist":r=t.getElementsByTagNameNS("*","Ad");break;case"VMAP":r=t.getElementsByTagNameNS("*","AdBreak");break;default:return void D.debug("ERROR: Unrecognized playlist format retrieved from master video tag: "+i.masterVideoTag)}for(var s={},d={preroll:0,midroll:0,postroll:0},u=!1,c={},f=0;f<r.length;f++){var l=r[f],p="Playlist"===a?Q(l.parentNode,a):Q(l,a),g="Playlist"===a?l.textContent.trim():l.getElementsByTagNameNS("*","AdTagURI")[0].textContent.trim();if(void 0!==p){var m,R;switch(p){case 0:R="preroll",p in s||(s[p]=!0,d[R]++),m="pr_"+d[R];break;case-2:R="postroll",p in s||(s[p]=!0,d[R]++),m="po_"+d[R];break;default:R="midroll",p in s||(s[p]=!0,d[R]++);var v=j("mridx",l.textContent.trim());m="m_",m+=void 0!==v?v:d[R]}var b=j("pmxd",g),h=void 0!==b,y=j("pmad",g),I=h?H(n,i,R,y,b):[""],E="nonlinear"===j("vad_type",g),w=i.size?J(i.size,E):J(j("sz",g),E);if(void 0===w)return void D.debug("ERROR: Invalid dimensions for sz");for(var O=0;O<I.length;O++){var x,k=O+1;if(h)void 0!==c[m+I[O]]?k=++c[m+I[O]]:(k=1,c[m+I[O]]=k),x=m+"_"+k+"_"+I[O]/1e3;else{var A=j("ppos",g);x=m+"_"+(k=A||k)+"_s"}if(p>=3600||-2===p&&u){var T=new Date(1970,0,1,0,0,0,0);T.setSeconds(p);var S=new Date(1970,0,1,0,0,0,0);S.setSeconds(3600),-2===p?D.debug("DEBUG: Postroll slot exceeds the "+S.toTimeString().slice(0,8)+" offset limit, skipping slot"):D.debug("DEBUG: Slot "+x+" has an offset of "+T.toTimeString().slice(0,8)+" exceeding the "+S.toTimeString().slice(0,8)+" offset limit, skipping slot"),u=!0}else{D.debug("DEBUG: Building slot configuration for slot "+x),n[R]=n[R]||{},n[R][d[R]]=n[R][d[R]]||{};var N=n[R][d[R]][k]||{},C=h?I[O]:void 0;o.addMasterVideoTagImpression(x,g,N,i,w.width,w.height,p,C)}}}else D.debug("ERROR: Could not parse start delay from ad pod element, skipping ad pod")}return o}D.debug("ERROR: Invalid overrides when creating request from Playlist")}else D.debug("ERROR: Invalid commonArgs when creating request from Playlist");else D.debug("ERROR: Invalid playlist XML when creating request from Playlist")},F=function(e,t,i){var n=[];e.sort();for(var o={},r=0;r<e.length;r++)if("number"==typeof e[r]&&!o[e[r]]){var a=Math.floor(i/(1e3*e[r]));a=void 0!==t?Math.min(a,t,5):Math.min(a,5);for(var s=0;s<a;s++)n.push(1e3*e[r]);o[e[r]]=1}return n},H=function(e,t,i,n,o){e[i]=e[i]||{};var r=e[i].durations||t.durations;return r instanceof Array&&0!==r.length?F(r,n,o):(D.debug("ERROR: No slot durations found for "+i+", used in an optimized pod."),[])},Q=function(e,t){switch(t){case"Playlist":switch(e.localName){case"Preroll":return 0;case"Midroll":return(i=e.getAttribute("timeOffset")).indexOf(":")>-1?$(i):-1;case"Postroll":return-2}case"VMAP":if("AdBreak"===e.localName){var i=e.getAttribute("timeOffset");switch(i){case"start":return 0;case"end":return-2;default:return i.indexOf(":")>-1?$(i):-1}}}},J=function(e,t){if("string"==typeof e){var i=e.split(","),n={};if(i.length>0){var o=i[0].split("x");2!==o.length?(D.debug("ERROR: Received invalid size, must be of format WxH"),n=k):(n.width=+o[0],n.height=+o[1])}return(!t&&!X(n)||isNaN(n.width)||isNaN(n.height))&&(n=k),n}},X=function(e){if(void 0===e.width||void 0===e.height)return!1;var t={1.78:!0,1.67:!0,1.6:!0,1.33:!0,1.25:!0}[Math.round(e.width/e.height*100)/100]||!1,i=e.width>=320&&e.height>=240;return t&&i},$=function(e){if(void 0!==e){var t=e.split(":");return 60*+t[0]*60+60*+t[1]+ +t[2]}};return{createRequest:q,createIVATag:L,evalQueue:function(){if(N instanceof Array){for(;0<N.length;)if("function"==typeof N[0])try{N[0](),N.splice(0,1)}catch(e){D.debug("ERROR: Error in deferQueue function: "+e.toString()),N.splice(0,1)}else D.debug("ERROR: deferQueue contains an element that is not a function, skipping."),N.splice(0,1);N.push=function(e){if("function"!=typeof e)D.debug("ERROR: deferQueue can not execute an element that is not a function, skipping.");else try{e()}catch(e){D.debug("ERROR: Error in deferQueue function: "+e.toString())}}}else D.debug("ERROR: deferQueue is not an Array, cannot evaluate.")},setDebugMode:function(e){"boolean"==typeof e?D.enabled(e):D.debug("ERROR: Invalid debug mode parameter.")},setRequestCallback:function(e){return"function"!=typeof e?(D.debug("ERROR: Request callback is not a function"),!1):(l=e,!0)},setRequestTimeout:function(e){return"number"!=typeof e||e%1!=0||e<0?(D.debug("ERROR: Timeout is not a number."),!1):(h=e,!0)},deferQueue:N,isMobile:function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},appendIndexBids:P,solicitIndexVideoAds:G,initHTVConfigs:U,jsonpResponse:function(t){try{if(!t)return void D.debug("ERROR: Received an invalid JSON object in response.");if("object"!=typeof t||void 0===t.id)return void D.debug("ERROR: Received an invalid JSON object in response.");var i=y[t.id];if(D.debug("DEBUG: Received JSON object in response for Request "+t.id),void 0===i)return void D.debug("ERROR: Could not find Request with id: "+t.id+".");var n=i.getImpressions(),o=[];if(w[i.getID()])return;if(window.clearTimeout(O[i.getID()]),void 0===t.seatbid){try{I[i.getID()]=s(i,1,void 0,[]),D.debug("DEBUG: Pass response parsed."),"function"==typeof E[i.getID()].pass?E[i.getID()].pass(i):"function"==typeof E[i.getID()].request?E[i.getID()].request(I[i.getID()]):"function"==typeof l&&l(I[i.getID()])}catch(e){D.debug("ERROR: Error in calling pass callback: "+e.toString())}return}for(var r=0;r<t.seatbid.length;r++)for(var a=0;a<t.seatbid[r].bid.length;a++){for(var d,u=t.seatbid[r].bid[a],c=0;c<n.length;c++)if(n[c].getImpressionID()===u.impid){d=n[c];break}if(void 0!==d)if("object"==typeof u.ext){var f=void 0,p=void 0,g=void 0,m=void 0,R=void 0,v=void 0;if("number"==typeof u.ext.advbrandid?g=u.ext.advbrandid:void 0!==u.ext.advbrandid&&D.debug("ERROR: Bid contained no valid advertiser ID."),"number"==typeof u.ext.deal?m=u.ext.deal:void 0!==u.ext.deal&&D.debug("ERROR: Bid contained no valid internal deal ID."),"string"==typeof u.dealid||"string"==typeof u.ext.dealid?R=u.dealid||u.ext.dealid:void 0!==u.dealid?D.debug("ERROR: Bid contained no valid deal ID."):void 0!==u.ext.dealid&&D.debug("ERROR: Bid contained no valid deal ID."),"string"==typeof u.ext.pricelevel)v=u.ext.pricelevel;else if(void 0!==u.ext.pricelevel){D.debug("ERROR: Price Level in the Bid was not a string.");continue}"string"==typeof u.ext.vasturl?(f=u.ext.vasturl,p=d):void 0!==u.ext.vasturl&&D.debug("ERROR: Bid contained no valid VAST creative url.");var b=e(p,g,R,m,v,f);o.push(b)}else D.debug("ERROR: Bid extension of bid "+u.impid+" is not an object.");else D.debug("ERROR: Could not find Impression with id "+u.impid+".")}}catch(e){if(D.debug("ERROR: Error parsing Response: "+e.toString()),void 0===i)return void s(void 0,2,void 0,void 0);try{I[i.getID()]=s(i,2,void 0,void 0),"function"==typeof E[i.getID()].error?E[i.getID()].error(i):"function"==typeof E[i.getID()].request?E[i.getID()].request(I[i.getID()]):"function"==typeof l&&l(I[i.getID()])}catch(e){D.debug("ERROR: Error in calling error callback: "+e.toString())}return}if(void 0!==i)if(o.length>0)try{I[i.getID()]=s(i,0,void 0,o),D.debug("DEBUG: Successful response parsed."),"function"==typeof E[i.getID()].success?E[i.getID()].success(I[i.getID()]):"function"==typeof E[i.getID()].request?E[i.getID()].request(I[i.getID()]):"function"==typeof l&&l(I[i.getID()])}catch(e){D.debug("ERROR: Error in calling success callback: "+e.toString())}else try{I[i.getID()]=s(i,1,void 0,o),D.debug("DEBUG: Pass response parsed."),"function"==typeof E[i.getID()].pass?E[i.getID()].pass(i):"function"==typeof E[i.getID()].request?E[i.getID()].request(I[i.getID()]):"function"==typeof l&&l(I[i.getID()])}catch(e){D.debug("ERROR: Error in calling pass callback: "+e.toString())}}}}(),t=top===self?location.href:document.referrer;"string"==typeof t&&new RegExp("[?&]ixdebug(=|&|#|$)","i").exec(t)&&e.setDebugMode(!0);var i=Object(e);void 0!==window[indexRootNamespaceRename]&&null!==window[indexRootNamespaceRename]&&(i=Object.assign({},i,window[indexRootNamespaceRename])),window[indexRootNamespaceRename]=i,window[indexRootNamespaceRename].initHTVConfigs(),window[indexRootNamespaceRename].evalQueue()}();
